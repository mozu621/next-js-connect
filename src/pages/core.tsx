import { profile } from 'console';
import { Formik } from 'formik';
import type { NextPage } from 'next';
import Head from 'next/head';

import { useEffect } from 'react';

import { useSelector, useDispatch } from 'react-redux';
import { Avatar } from '../../components/Avatar';
import { Like } from '../../components/Like';
import styles from '../../styles/Home.module.css';
import { AppDispatch } from '../app/store';
import { selectProfile, selectProfiles } from '../app/store/slices/authSlice';
import {
  fetchAsyncNewPortfolio,
  fetchPostEnd,
  fetchPostStart,
  selectPortfolios,
} from '../app/store/slices/portfolioSlice';

const Home: NextPage = () => {
  const myprofile = useSelector(selectProfile);
  const profiles = useSelector(selectProfiles);
  const portfolios = useSelector(selectPortfolios);
  const dispatch: AppDispatch = useDispatch();

  return (
    <>
      <Head>
        <title>Create Next App</title>
        <meta name='description' content='Generated by create next app' />
        <link rel='icon' href='/favicon.ico' />
      </Head>
      <div>{myprofile.nickName}</div>
      {console.log(myprofile.img)}
      <Avatar imgurl={myprofile.img} />
      {portfolios.map((portfolio, i) => (
        <div key={i}>
          {portfolio.id}
          <button
            className='py-2 px-4 font-bold bg-blue-500 hover:bg-blue-700 rounded-full '
            type='submit'
          >
            {portfolio.author}
            {portfolio.title}
          </button>

          <Like likePortfolio={portfolio.id} />
          {portfolio.img && <Avatar imgurl={portfolio.img} />}
        </div>
      ))}

      {profiles.map((profile, i) => (
        <div key={i}>
          {profile.id}
          <button
            className='py-2 px-4 font-bold bg-blue-500 hover:bg-blue-700 rounded-full '
            type='submit'
          >
            {profile.nickName}
            {profile.profileUser}
          </button>
          {profile.img && <Avatar imgurl={profile.img} />}
        </div>
      ))}

      <Formik
        initialValues={{ title: '', img: null }}
        onSubmit={async (values) => {
          await dispatch(fetchPostStart());
          const result = await dispatch(fetchAsyncNewPortfolio(values));
          await dispatch(fetchPostEnd());
        }}
      >
        {(props) => (
          <section className='mt-10'>
            <form onSubmit={props.handleSubmit} className='flex flex-col'>
              <div className='pt-3 mb-6 bg-gray-200 rounded'>
                <label className='block mb-2 ml-3 text-sm font-bold text-gray-700'>title</label>
                <input
                  type='text'
                  onChange={props.handleChange}
                  onBlur={props.handleBlur}
                  value={props.values.title}
                  name='title'
                  className='px-3 pb-3 w-full text-gray-700 bg-gray-200 rounded border-b-4 border-gray-300 focus:border-purple-600 focus:outline-none transition duration-500'
                />
              </div>

              <button
                className='py-2 px-4 font-bold bg-blue-500 hover:bg-blue-700 rounded-full '
                type='submit'
              >
                Create
              </button>
            </form>
          </section>
        )}
      </Formik>
    </>
  );
};

export default Home;
